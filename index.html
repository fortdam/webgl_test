<html>

<head>
<title>t3d test</title>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
<script src="t3d.js"></script>
<script type="text/javascript">

    var drawObject1, drawObject2, drawObject3;
    var projectionMatrix1, projectionMatrix2,projectionMatrix3;

        var vertexShaderSource =
                " attribute vec3 vertexPos;\n" +
                " uniform mat4 projectionMatrix;\n" +
                " void main(void) {\n" +
                " // Return the transformed and projected vertex value\n" +
                " gl_Position = projectionMatrix * \n" +
                " vec4(vertexPos, 1.0);\n" +
                " }\n";

        var fragmentShaderSource =
                " precision mediump float;\n" +
                " uniform vec4 ccolor;\n" +
                " void main(void) {\n" +
                " // Return the pixel color: always output white\n" +
        " gl_FragColor = ccolor;\n" +
            "}\n";

     function draw() {
         t3d.startDraw();
         drawObject1.draw();
         //drawObject2.draw();
         //drawObject3.draw();

      }
          
    function initObj1() {
             projectionMatrix1 = (new Matrix()).lookAt(0,0,2.5).frustum(-1,1,-1,1,1,100);

         drawObject1 = new DrawObject();
         drawObject1.setupProgram(vertexShaderSource, fragmentShaderSource);

         var verts = [
             .1, .8, 0.0,
            -.8, .8, 0.0,
             .1, -.8, 0.0,
            -.8, -.8, 0.0
        ];
         drawObject1.addVertexData("vertexPos", 3, verts);

         var indice = [0,1,2, 1,2,3];
         drawObject1.addVertexIndex(indice);
 
         drawObject1.addUniform("projectionMatrix", "matrix", 4, projectionMatrix1);
         drawObject1.addUniform("ccolor", "float", 4, [0, 1.0, 0, 0.5]);

    }

    function initObj2() {
             projectionMatrix2 = (new Matrix()).lookAt(0,0,2.5).frustum(-1,1,-1,1,1,100);

         drawObject2 = new DrawObject();
         drawObject2.setupProgram(vertexShaderSource, fragmentShaderSource);

         var verts = [
             .8, .8, 0.0,
            -.1, .8, 0.0,
             .8, -.8, 0.0,
            -.1, -.8, 0.0
        ];
         drawObject2.addVertexData("vertexPos", 3, verts);

         var indice = [0,1,2, 1,2,3];
         drawObject2.addVertexIndex(indice);
 
         drawObject2.addUniform("projectionMatrix", "matrix", 4, projectionMatrix1);
         drawObject2.addUniform("ccolor", "float", 4, [1.0, 0, 0, 0.5]);

    }

    function initObj3() {
             projectionMatrix3 = (new Matrix()).lookAt(0,0,2.5).frustum(-1,1,-1,1,1,100);

         drawObject3 = new DrawObject();
         drawObject3.setupProgram(vertexShaderSource, fragmentShaderSource);

         var verts = [
             0, .5, 0.0,
            -.5, -.5, 0.0,
             .5, -.5, 0.0,
         ];
         drawObject3.addVertexData("vertexPos", 3, verts);

         var indice = [0,1,2];
         drawObject3.addVertexIndex(indice);
 
         drawObject3.addUniform("projectionMatrix", "matrix", 4, projectionMatrix1);
         drawObject3.addUniform("ccolor", "float", 4, [0, 0, 1.0, 0.5]);

    }

    function onLoad() {
        var canvas = document.getElementById("webglcanvas");
        try {
        var gl = t3d.init(canvas);
  
        initObj1();
        initObj2();
        initObj3();
        draw();
        
        var colorStep = 1.0;
        var xD = 0;
        var yD = 0;
        var zD = 0;
        
        window.setInterval(function(){
                xD += 2;
                yD += 3
                zD += 4;

                xD = (xD>180)?-180:xD;
                yD = (yD>180)?-180:yD;
                zD = (zD>180)?-180:zD;

         projectionMatrix1 = (new Matrix()).rotate(xD, yD, zD).lookAt(0,0,2.5).frustum(-1,1,-1,1,1,100);
         drawObject1.addUniform("projectionMatrix", "matrix", 4, projectionMatrix1);
                
                         projectionMatrix2 = (new Matrix()).rotate(-yD, -zD, -xD).lookAt(0,0,2.5).frustum(-1,1,-1,1,1,100);
         drawObject2.addUniform("projectionMatrix", "matrix", 4, projectionMatrix2);

                         projectionMatrix3 = (new Matrix()).rotate(0, -yD, -zD).lookAt(0,0,2.5).frustum(-1,1,-1,1,1,100);
         drawObject3.addUniform("projectionMatrix", "matrix", 4, projectionMatrix3);

                draw()
            }, 20);
         }
        catch(e) {
        alert("Error" + e.toString() + " line:" +e.lineNumber);
        }
    }


</script>


</head>


<body onload="onLoad();">

    <canvas id="webglcanvas" style="border: none;" width="500" height="500"></canvas>

</body>

</html>


